# README — Automated Classification of Primary Headache Disorders (Python notebook)

**Repository author:** Ghaith Al‑Gburi  
**Study context:** Primary headache disorders such as migraine and tension‑type headache are among the most disabling neurological conditions, yet accurate diagnosis in clinical practice remains challenging.  To improve case identification and understand misclassification, this repository provides a rule‑based algorithm derived from the **International Classification of Headache Disorders (ICHD‑3 beta)** and applies it to survey data collected in Iraqi healthcare settings.  The analysis explores descriptive characteristics of the sample, performs automated classification of headache types, evaluates agreement with specialist diagnoses and examines which background factors are associated with classification accuracy.

---

## Quick view

You can view the complete analysis (rendered HTML with interactive plots) here:

[Open the full analysis report (HTML)](https://rawcdn.githack.com/GhaithAl-Gburi/primary-headache-classification/main/classify_headache.html)

---

## Purpose

This repository contains `classify_headache.ipynb` — a Python notebook that reads survey responses coded as ICHD‑3 beta items, implements a set of functions to assign **automatic diagnoses** of migraine, tension‑type headache, trigeminal autonomic cephalalgias and related conditions, and compares these assignments against the specialist‑confirmed codes in the data set.  The notebook also generates descriptive statistics for demographic variables and medication use, investigates cases where tension‑type headaches were misclassified as migraine, and tests whether classification accuracy varies across age, survey version, healthcare centre, gender or education.  Results are exported as a CSV file and visualised in `classify_headache.html`.

> **Data privacy:** The raw participant‑level data are de‑identified.  The input CSV file used in the analysis (`primary_headache_data.csv`) is not publicly available here due to patient confidentiality.  Researchers who wish to reproduce the analysis should supply their own anonymised data coded according to the scheme described below.

---

## Files in this repo

| File | Description |
|------|-------------|
| **`classify_headache.ipynb`** | Main Jupyter notebook.  Contains code to load the data, compute descriptive statistics, implement the ICHD‑3 beta diagnostic rules, assign automatic diagnoses, compare them with specialist codes, explore misclassified cases and assess associations with background factors. |
| **`classify_headache.html`** | Rendered version of the notebook showing narrative, tables and plots.  Open this file in a web browser to review the results without running the code. |
| **`Item_coding_and_assignment_procedure.xlsx`** | Metadata describing the survey items.  The workbook includes four sheets: *Items name* (question names and descriptions), *Items coding* (allowed values and coding schemes), *Item membership* (which conditions each item contributes to in the ICHD‑3 beta algorithm) and *Diagnostic hierarchy* (priority order of diagnoses). |
| **`primary_headache_data.csv`** | Input data file (not included here).  Rows correspond to survey respondents, columns correspond to items `I1`–`I51` as defined in the Excel workbook. |
| **`primary_headache_output.csv`** | Output file generated by the notebook containing the original data with additional columns for automatic diagnosis, first‑level accuracy, second‑level accuracy and overall classification accuracy. |
| **`LICENSE`** | License file (GNU Affero General Public License v3.0). |
| **`README.md`** | This documentation file. |

---

## Required Python version & packages

The notebook requires **Python ≥ 3.8** and the following Python packages:

```bash
pip install pandas numpy matplotlib seaborn scipy jupyter
```

These packages handle data manipulation (`pandas`, `numpy`), visualisation (`matplotlib`, `seaborn`) and non‑parametric statistics (`scipy.stats`).  Jupyter Notebook or JupyterLab is recommended for executing the notebook interactively.

---

## Expected data format (column names)

The code expects a CSV file named `primary_headache_data.csv` in the working directory.  Each row represents one respondent, and the columns must follow the naming conventions used in the **ICHD‑3 beta questionnaire**.  The main categories of variables are summarised below (see `Item_coding_and_assignment_procedure.xlsx` for full details and coding rules):

| Category | Item codes (examples) | Description & coding |
|---------|-----------------------|----------------------|
| **General information** | `I1`–`I5` | Date of record (`I1`), survey version (`I2`, coded 0=First, 1=Second), response time in minutes (`I3`), unique patient identifier (`I4`), and data source / healthcare centre (`I5`, coded 0=Baghdad Teaching Hospital, 1=Imam Hussein Medical City). |
| **Diagnosis & demographics** | `I6`, `I6-a`, `I6-b`, `I7`, `I8`, `I9` | Specialist diagnosis as an ICHD‑3 beta code (`I6`), pattern and cause of secondary headache (`I6-a`, `I6-b`), participant age in years (`I7`), gender (`I8`, coded 0=Male, 1=Female) and educational level (`I9`, coded 0=No formal education, 1=Primary school, 2=Secondary school, 3=College or higher). |
| **Aura and prodromal symptoms** | `I10`–`I20` | Duration of headache attack (`I10`), number of episodes (`I29`), migraine‑related features such as unilateral pain (`I22`), pulsating quality (`I23`), exacerbation with routine activity (`I24`), nausea (`I25`), vomiting (`I26`), photophobia (`I27`) and phonophobia (`I28`); aura characteristics including visual symptoms (`I11`), numbness/tingling (`I12`), speech disturbance (`I13`), spread and succession of symptoms (`I14`–`I16`), scintillation/pins‐and‑needles (`I17`), unilateral aura (`I18`), and timing of aura relative to headache (`I19`).  Most of these items are binary (0=No, 1=Yes). |
| **Headache frequency & chronicity** | `I20`–`I34` | Number of migraine episodes (`I20`), monthly episode count (`I21`, `I31`), and number of days per year with tension‑type headaches (`I32`).  Items `I30` and `I34` capture headache severity and duration categories. |
| **Cluster and trigeminal autonomic features** | `I36`–`I46` | Indicators for autonomic symptoms such as lacrimation, nasal congestion, eyelid oedema, forehead/facial sweating, miosis/ptosis (`I36`–`I40`), restlessness (`I41`), frequency of daily episodes (`I42`), precipitating factors (`I43`), number of lifetime episodes (`I44`), duration of disorder (`I45`) and uncertainty about diagnosis (`I46`). |
| **Medication use** | `I47`–`I51` | Binary indicators for medication taken: Ergotamine (`I47`), Triptan (`I48`), Paracetamol (`I49`), non‑steroidal anti‑inflammatory drugs (`I50`) and Tramadol/Morphine (`I51`).  A participant with no medications is recorded when all medication items equal 0. |

Variables must be coded numerically as specified in the *Items coding* sheet of the Excel file.  Continuous variables (e.g., age, response time) should be numeric, while categorical variables are coded as factors using integers.

---

## How to run

### Option 1 — Run in Jupyter Notebook

1. Clone or download this repository.  Ensure that your data file `primary_headache_data.csv` is in the repository root.
2. Install the required packages as described above.
3. Open `classify_headache.ipynb` in Jupyter Notebook or JupyterLab.
4. Run all cells.  The notebook will:
   - Display session information and read the data.
   - Produce descriptive statistics for survey version, data source, gender, education and age, and plot medication usage.
   - Assign automatic diagnoses using ICHD‑3 beta rules (functions `evaluate_1_1`, `evaluate_1_2`, etc.).
   - Compute first‑ and second‑level classification accuracy compared with the specialist code (`I6`).
   - Summarise misclassification patterns (e.g., tension‑type headache misclassified as migraine) and plot aura and symptom frequencies among these cases.
   - Test associations between classification accuracy and background factors using Kruskal–Wallis and Fisher’s exact tests, reporting effect sizes (ε² and Cramer’s V).
   - Save a new CSV file `primary_headache_output.csv` containing the automatic diagnoses and accuracy metrics.

### Option 2 — Execute and convert to HTML from the command line

You can run the notebook and produce the HTML report without opening Jupyter interactively:

```bash
# execute the notebook and generate an HTML report
jupyter nbconvert --to html --execute classify_headache.ipynb --output classify_headache.html
```

Make sure that `primary_headache_data.csv` is available in the working directory before executing the command.  The resulting `classify_headache.html` file will contain all tables and plots.

---

## Analysis workflow

The analysis performed in `classify_headache.ipynb` follows these steps:

1. **Setting the environment** – Import packages, print session information and read the CSV data file into a pandas DataFrame.
2. **Descriptive statistics** – Summarise categorical variables (survey version, healthcare centre, gender, educational level) using value counts; describe continuous variables like age; and visualise medication usage across participants.
3. **Automated primary headache classification** – Define helper functions implementing the ICHD‑3 beta criteria for migraine without aura (1.1), migraine with aura (1.2), chronic migraine (1.3), tension‑type headaches (2.x), trigeminal autonomic cephalalgias (3.x) and their probable forms.  Each participant is evaluated against these rules to assign an **automatic diagnosis code**.
4. **Automated classification accuracy** – Compare the automatic diagnosis with the specialist code (`I6`) at the first digit (disorder category) and second digit (subtype) levels; classify each case as *Second‑level*, *First‑level* or *Misclassified*; summarise accuracy distributions; and visualise agreement via a heat map with colour coding (green for perfect match, orange for first‑level match, red for mismatch).
5. **Explore cases misclassified as migraine** – Identify participants with tension‑type headache (specialist code starting with “2.”) who were automatically classified as migraine (code starting with “1.”); examine the prevalence of aura symptoms and migraine features among these misclassified cases; and plot the counts of each symptom.
6. **Association between background factors and classification accuracy** – Test whether age or response time differs across accuracy categories using Kruskal–Wallis tests and compute effect sizes (ε²); test associations between categorical factors (survey version, data source, gender, education) and accuracy using Fisher’s exact test and report Cramer’s V; and visualise age and response time distributions across accuracy categories.
7. **Output** – Write the augmented data frame to `primary_headache_output.csv` for further analysis or record keeping.

---

## License & citation

This repository is released under the **GNU Affero General Public License v3.0**.  See the `LICENSE` file for details about copying, distribution and attribution requirements.

If you use or adapt this code in your own research, please cite the repository as follows (replace the year with the year accessed):

```
Ghaith Al‑Gburi. (2026). GhaithAl‑Gburi/primary‑headache‑classification: Automated ICHD‑3 beta diagnosis and analysis of primary headaches (v1.0.0). Zenodo. https://doi.org/10.5281/zenodo.XXXXXXX
```

You should also cite the relevant journal article or preprint describing the methodology and results of the study.  Please contact the author for further details.

---

## Contact

For questions or collaborations, please contact:

- **Author:** Ghaith Al‑Gburi  
- **Email:** ghaith.ali.khaleel@gmail.com  
- **GitHub:** [https://github.com/GhaithAl-Gburi](https://github.com/GhaithAl-Gburi)  
- **ORCID:** `0000‑0001‑7427‑8310`
