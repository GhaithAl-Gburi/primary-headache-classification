# README — Automated Classification of Primary Headache Disorders (Python notebook)

**Repository author:** Ghaith Al‑Gburi  

**Purpose:** Primary headache disorders such as migraine and tension‑type headache are among the most common neurological conditions, yet accurate diagnosis in clinical practice remains challenging.  To improve case identification and understand misclassification, this repository provides a rule‑based algorithm derived from the **International Classification of Headache Disorders (ICHD‑3 beta)** and applies it to survey data collected in Iraqi healthcare settings. This repository contains `classify_headache.ipynb` — a Python notebook that reads survey responses coded as ICHD‑3 beta items, implements a set of functions to assign **automatic diagnoses** of migraine, tension‑type headache, trigeminal autonomic cephalalgias and related conditions, and compares these assignments against the specialist‑confirmed codes in the data set. 

> **Data privacy:** The raw participant‑level data are de‑identified.

---

## Quick view

You can view the complete analysis (rendered HTML with interactive plots) here:

[Open the full analysis report (HTML)](https://rawcdn.githack.com/GhaithAl-Gburi/primary-headache-classification/main/classify_headache.html)

---

## Files in this repo

| File | Description |
|------|-------------|
| **`classify_headache.ipynb`** | Main Jupyter notebook.  Contains code to load the data, compute descriptive statistics, implement the ICHD‑3 beta diagnostic rules, assign automatic diagnoses, compare them with specialist codes, explore misclassified cases and assess associations with background factors. |
| **`classify_headache.html`** | Rendered version of the notebook showing narrative, tables and plots.  Open this file in a web browser to review the results without running the code. |
| **`Item_coding_and_assignment_procedure.xlsx`** | Metadata describing the survey items.  The workbook includes four sheets: *Items name* (question names and descriptions), *Items coding* (allowed values and coding schemes), *Item membership* (which conditions each item contributes to in the ICHD‑3 beta algorithm) and *Diagnostic hierarchy* (priority order of diagnoses). |
| **`primary_headache_data.csv`** | Input data file.  Rows correspond to survey respondents, columns correspond to items `I1`–`I51`. |
| **`primary_headache_output.csv`** | Output file generated by the notebook containing the original data with additional columns for automatic diagnosis, first‑level accuracy (type accuracy), second‑level accuracy (subtype accuracy) and overall classification accuracy. |
| **`LICENSE`** | License file (GNU Affero General Public License v3.0). |
| **`README.md`** | This documentation file. |
| **`Research survey`** | A directory containing surveys used for data collection. |

---

## Required Python version & packages

The notebook requires **Python ≥ 3.8** and the following Python packages:

```bash
pip install pandas numpy matplotlib seaborn scipy jupyter
```

These packages handle data manipulation (`pandas`, `numpy`), visualisation (`matplotlib`, `seaborn`) and non‑parametric statistics (`scipy.stats`).  Jupyter Notebook or JupyterLab is recommended for executing the notebook interactively.

---

## Expected data format (column names)

The code expects a CSV file named `primary_headache_data.csv` in the working directory.  Each row represents one respondent, and the columns must follow the naming conventions described in  **Item_coding_and_assignment_procedure.xlsx**.  The main categories of variables are summarised below:

| Category | Item codes (examples) |
|---------|-----------------------|
| **General information** | `I1`–`I5` |
| **Diagnosis & demographics** | `I6`, `I6-a`, `I6-b`, `I7`, `I8`, `I9` |
| **Aura and general headache symptoms** | `I10`–`I22` |
| **Prolonged headaches features** | `I23`–`I33` |
| **Brief headaches features** | `I34`–`I46` |
| **Medication use** | `I47`–`I52` |

Variables must be coded numerically as specified in the *Items coding* sheet of the Excel file.  Continuous variables (e.g., age, response time) should be numeric, while categorical variables are coded as factors using integers.

---

## How to run

### Option 1 — Run in Jupyter Notebook

1. Clone or download this repository.  Ensure that your data file `primary_headache_data.csv` is in the repository root.
2. Install the required packages as described above.
3. Open `classify_headache.ipynb` in Jupyter Notebook or JupyterLab.
4. Run all cells.  

### Option 2 — Execute and convert to HTML from the command line

You can run the notebook and produce the HTML report without opening Jupyter interactively:

```bash
# execute the notebook and generate an HTML report
jupyter nbconvert --to html --execute classify_headache.ipynb --output classify_headache.html
```

Make sure that `primary_headache_data.csv` is available in the working directory before executing the command.  The resulting `classify_headache.html` file will contain all tables and plots.

---

## Analysis workflow

The analysis performed in `classify_headache.ipynb` follows these steps:

1. **Setting the environment** – Import packages, print session information and read the CSV data file into a pandas DataFrame.
2. **Descriptive statistics** – Summarise categorical variables (survey version, healthcare centre, gender, educational level) using value counts; describe continuous variables like age; and visualise medication usage across participants.
3. **Automated primary headache classification** – Define functions implementing the ICHD‑3 beta criteria for migraine (1.X), tension‑type headaches (2.x), trigeminal autonomic cephalalgias (3.x) and their probable forms.  Each participant is evaluated against these rules to assign an **automatic diagnosis code**.
4. **Automated classification accuracy** – Compare the automatic diagnosis with the specialist code (`I6`) at the first digit (type accuracy) and second digit (subtype accuracy); summarise accuracy distributions and visualise via a heat map with colour coding (green for perfect match, orange for first‑level match, red for mismatch).
5. **Explore cases misclassified as migraine** – Identify participants with tension‑type headache who were automatically classified as migraine; examine the prevalence of aura symptoms and migraine features among these cases.
6. **Association between background factors and classification accuracy** – Test whether age or response time differs across accuracy categories using Kruskal–Wallis tests and compute effect sizes (ε²); test associations between categorical factors (survey version, data source, gender, education) and accuracy using Fisher’s exact test and report Cramer’s V.
7. **Output** – Write the augmented data frame to `primary_headache_output.csv` for further analysis or record keeping.

---

## License & citation

This repository is released under the **GNU Affero General Public License v3.0**.  See the `LICENSE` file for details about copying, distribution and attribution requirements.

If you use or adapt this code in your own research, please cite the repository as follows (replace the year with the year accessed):

```
Ghaith Al‑Gburi. (2026). GhaithAl‑Gburi/primary‑headache‑classification: Automated ICHD‑3 beta diagnosis and analysis of primary headaches (v1.0.0). Zenodo. https://doi.org/10.5281/zenodo.XXXXXXX
```

---

## Contact

For questions, please contact:

- **Author:** Ghaith Al‑Gburi  
- **Email:** ghaith.ali.khaleel@gmail.com  
- **GitHub:** [https://github.com/GhaithAl-Gburi](https://github.com/GhaithAl-Gburi) 
- **ORCID:** `0000‑0001‑7427‑8310`
